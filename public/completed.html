<!doctype html>

<html lang=en>
    <head>
        <meta charset=UTF-8>
        <meta name=viewport content="width=device-width, initial-scale=1, minimum-scale=1">
        <meta name=description content="LogIt Completed Tasks">
        <title>Completed Tasks</title>
        <link rel="stylesheet" type="text/css" href="css/base.css">

    </head>
    <body>

        <div class="modal">
            <div class="modal-content">
                <div class="modal-header">Edit Task<span class="close">&times;</span></div>      
                <ul class=modal-list>
                </ul>
            </div>
        </div>

        <div class=modal>
                <div class=modal-content>
                    <div class=modal-header>Create Task<span class=close>&times;</span></div>
                    <ul class=modal-list>
                    </ul>
                </div>
        </div>

        <div class=topnav>
            <div id=hamburger>
                <span></span>
                <span></span>
                <span></span>
            </div>
            <button id=createbtn>Create Task</button>
        </div>

        <div id=sidebar>
            <ul>
                <li id=todo>Todo</li>
                <li id=completed style="color:#D8124E">Completed</li>
                <li id=signout>Logout</li>
            </ul>
        </div>

        <h1>Tasks Completed</h1>

        <ul id=list>
        </ul>
        
        <script src="https://www.gstatic.com/firebasejs/5.0.4/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.0.4/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.0.4/firebase-firestore.js"></script>
        <script src="js/app.js"></script>
        <script src="js/main.js"></script>

        <script>
            var database = firebase.firestore();
            firebase.firestore().settings({
                timestampsInSnapshots: true
            });
   
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    database.collection("users").doc(user.uid).collection("completed").orderBy("timestamp").get()
                    .then(snapshot => {
                        snapshot.forEach(doc => {
                            var date = doc.data().date; 
                            var task = `<li id=${doc.id}>` + "<span style='float:left; font-weight: bold'>" + doc.data().title + "</span><span style='float:right'>"  
                                + `<button id='edit_${doc.id}' class='task edit' onclick='displayEditScreen(this.id, "completed")'>Edit</button>`  
                                + `<button id='dele_${doc.id}' class='task delete' onclick='deleteTask(this.id, "completed")'>Delete</button>` 
                                + "</span>" + `<br><span style='font-size: 18px'>${date}` + "</span></li>";
                            document.getElementById("list").innerHTML += task;
                        }); 
                    })
                    .catch(err => {
                        console.log("Error getting documents ", err);
                    });
                }
                else {
                    window.location.href = "index.html";
                }
            });
        </script>
        <noscript>JavaScript not enabled</noscript>
    </body>
</html>